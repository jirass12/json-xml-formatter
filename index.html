<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON XML Formatter</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #con { display: flex; gap: 20px; }
        #rad {display: flex; flex-direction: column; justify-content: center; gap: 20px;}
        textarea { width: 100%; height: 100px; flex: 7; }
        button { width: 100%; padding: 10px 20px; font-size: 16px; flex: 1; }
        #output { margin-top: 20px; background-color: #f8f8f8; padding: 10px; border: 1px solid #ddd; }
        code { white-space: pre-wrap; display: block; padding: 10px; }
        .string { color: green; } .number { color: blue; } .boolean { color: purple; } .null { color: red; } .key { color: brown; }
        .xml-tag { color: brown; } .xml-attribute { color: red; } .xml-value { color: blue; } .xml-text { color: green; }
        #scrollTopBtn { display: none; position: fixed; bottom: 20px; right: 20px; z-index: 99; font-size: 18px; border: none; outline: none; background-color: #555; color: white; cursor: pointer; padding: 15px; border-radius: 4px; width:50px }
        #scrollTopBtn:hover { background-color: #333; }
        .collapsible { cursor: pointer; }
        .collapsible::before { content: '▶'; padding-right: 5px; }
        .active::before { content: '▼'; }
        .content { display: inline;}
        .content.collapsed { display: none; }
    </style>
</head>
<body>
    <div id="con">
        <textarea id="textInput"></textarea>
        <div id="rad">
            <span>
                <input type="radio" name="lang" value="json" checked>JSON
            </span>
            <span>
                <input type="radio" name="lang" value="xml">XML
            </span>
        </div>
        <button onclick="formatText()">Format</button>
        <button onclick="clearText()">Clear</button>
    </div>
    <div id="output"></div>
    <button onclick="scrollToTop()" id="scrollTopBtn" title="Go to top">↑</button>
    <script>
        function formatText() {
            const input = document.getElementById('textInput').value.trim();
            const selected = document.querySelector('input[name="lang"]:checked');
            if (selected.value == "json") {
                formatJSON(input);
            } else if (selected.value == "xml") {
                formatXML(input);
            }
        }

        function formatJSON(input) {
            let formattedText = '', indentLevel = 0, indent = '    ';
            for (let char of input) {
                if (char === '{' || char === '[') {
                    formattedText += char + '\n' + indent.repeat(Math.max(0, ++indentLevel));
                } else if (char === '}' || char === ']') {
                    formattedText += '\n' + indent.repeat(Math.max(0, --indentLevel)) + char;
                } else if (char === ',') {
                    formattedText += char + '\n' + indent.repeat(Math.max(0, indentLevel));
                } else if (char !== '\n' && char !== '\r') {
                    formattedText += char;
                }
            }
            document.getElementById('output').innerHTML = syntaxHighlightJSON(formattedText);
            addCollapsibleListeners();
        }

        function formatXML(input) {
            let formattedText = '', indentLevel = 0, indent = '    ';
            input.split(/>\s*</).forEach(node => {
                if (node.match(/^\/\w/)) indentLevel--;
                formattedText += indent.repeat(Math.max(0, indentLevel)) + '<' + node + '>\n';
                if (node.match(/^<?\w[^>]*[^\/]$/)) indentLevel++;
            });
            formattedText = formattedText.substring(1, formattedText.length - 2);
            document.getElementById('output').innerHTML = '<code>' + syntaxHighlightXML(formattedText) + '</code>';
        }

        function syntaxHighlightJSON(json) {
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            json = json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, match => {
                let cls = 'number';
                if (/^"/.test(match)) cls = /:$/.test(match) ? 'key' : 'string';
                else if (/true|false/.test(match)) cls = 'boolean';
                else if (/null/.test(match)) cls = 'null';
                return `<span class="${cls}">${match}</span>`;
            });

            // Add collapsible functionality
            json = json.replace(/(\{|\[|\}|\])/g, match => {
                if (match === '{' || match === '[') {
                    return `<span class="collapsible active">${match}</span><div class="content">`;
                } else if (match === '}' || match === ']') {
                    return `</div><span>${match}</span>`;
                } else {
                    return match;
                }
            });

            return '<code>' + json + '</code>';
        }

        function syntaxHighlightXML(xml) {
            xml = xml.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return xml.replace(/(&lt;\/?[^&]+?&gt;|&quot;[^&]+?&quot;|&lt;[^&]+?&gt;)/g, match => {
                let cls = 'xml-tag';
                if (/^&lt;\/[^&]+&gt;$/.test(match)) cls = 'xml-tag';
                else if (/^&lt;[^&]+&gt;$/.test(match)) cls = 'xml-tag';
                else if (/&quot;[^&]+&quot;/.test(match)) cls = 'xml-value';
                return `<span class="${cls}">${match}</span>`;
            });
        }

        function addCollapsibleListeners() {
            const coll = document.getElementsByClassName("collapsible");
            for (let i = 0; i < coll.length; i++) {
                coll[i].addEventListener("click", function () {
                    this.classList.toggle("active");
                    const content = this.nextElementSibling;
                    if (content.style.display === "none") {
                        content.style.display = "inline";
                    } else {
                        content.style.display = "none";
                    }
                });
            }
        }

        function clearText() {
            document.getElementById('textInput').value = '';
            document.getElementById('output').innerHTML = '';
        }

        window.onscroll = function () { scrollFunction(); };

        function scrollFunction() {
            const scrollTopBtn = document.getElementById("scrollTopBtn");
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                scrollTopBtn.style.display = "block";
            } else {
                scrollTopBtn.style.display = "none";
            }
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
